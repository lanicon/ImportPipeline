<?xml version="1.0" encoding="utf-8" ?>
<root>
   <script file="scriptextensions.cs" />
   <tempdir dir="temp" clearonstart="true" />
   <endpoints>
      <endpoint name="es" type="ESEndpoint" url="http://localhost:9200/" cache="300" maxparallel="1">
         <waitfor status="yellow|green"></waitfor>
         <indexes>
            <index name="bosgoed" config="index.config.js"  >
              <type name="bosdoc" keyfield="filename" datefield="filedate" />  
              <type name="errors_"  />  
              <type name="admin_"  />  
            </index>
         </indexes>
      </endpoint>
   </endpoints>

   <converters>
      <converter name="urlEncode"/>
      <converter name="htmlDecode"/>
      <converter name="int32"/>
      <converter name="double" decimalsep="," groupsep="."/>
      <converter name="date"   mode="toUtc" _formats="yyyyMMdd">
         <timezone name="CEST" offset="+0200" />
         <timezone name="CET" offset="+0100" />
      </converter>
      <converter name="string"/>
      <converter name="year"   mode="toLocal" select="y" type="datepart"/>
      <converter name="lower" />
      <converter name="upper" />
      <converter name="trim" />
      <converter name="doctype" type="ReplaceConverter" dumpmissed="100">
         <replace value="application/pdf" repl="Pdf" />
         <replace value="application/msword" repl="Word" />
         <replace value="application/rtf" repl="Word" />
         <replace value="application/vnd.openxmlformats-officedocument.wordprocessingml.document" repl="Word" />
         <replace value="application/vnd.ms-excel" repl="Excel" />
         <replace value="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" repl="Excel" />
         <replace value="application/vnd.ms-powerpoint" repl="Powerpoint" />
         <replace value="application/vnd.openxmlformats-officedocument.presentationml.presentation" repl="Powerpoint" />
         <replace value="ConversionError" repl="Error" />
         <replace expr="message" repl="Mail" />
         <replace expr="text" repl="Text" />
      </converter>

   </converters>
   <processes>
      <process name='tika' maxrestarts="25" log="tika" errlog="tika_err" logfrom="tika" clearlogs="false">
         <exe>%JAVA_HOME%\bin\java</exe>
         <arguments>-jar %IMPORT_TIKA_CMD%</arguments>
         <shutdown method="GET" url="http://localhost:8080/shutdown" />
      </process>
   </processes>

   <pipelines>
      <pipeline name="tika" trace="false" converters="trim" endpoint="es.bosdoc" script="ScriptExtensions" >
         <_action key="record" script="ErrorOn2"/>
         <action key="record" add="*" script="OnAdd"/>
         <action key="record/_start" field="filename" tovar="key"/>
         <action key="record/_start" field="errorFileName" endpoint="es.errors_" />
         <action key="record/_istextmail" field="isTextMail" />
         <action key="record/_numparts" field="numparts" />
         <action key="record/_numattachments" field="numattachments" />
         <action key="record/_filesize" field="filesize" />
         <action key="record/lastmodutc" field="filedate" converters="date" tovar="date"/>
         <action key="record/virtualFilename" field="virtualFilename" />
         <action key="record/converted_file" field="convertedFilename" />
         <action key="record/page_count|record/xmptpg:npages" field="page_count" converters="int32"/>
         <action key="record/_checkexist" check="key|date"/>
         <action key="record/subject" field="subject" converters="htmlDecode" />
         <action key="record/keywords" field="keywords" converters="htmlDecode"/>
         <action key="record/head" field="head" />
         <action key="record/content" field="content" />
         <action key="record/shortcontent" field="shortcontent" />
         <action key="record/Message-From" field="author" flags="unique|toarray"  converters="htmlDecode"/>
         <action key="record/Message-To" field="recip" flags="unique|toarray"  converters="htmlDecode"/>
         <action key="record/Message-CC" field="recip_cc" flags="unique|toarray"  converters="htmlDecode"/>
         <action key="record/Message-ID" field="msg_id" />
         <action key="record/Message-ID" field="msg_ref" flags="unique|toarray" />
         <action key="record/In-Reply-To" field="msg_ref" flags="unique|toarray"/>
         <action key="record/References" field="msg_ref" flags="unique|toarray"/>
         <action key="record/security/group/allow" field="secgroups" flags="unique|toarray" converters="string"/>

         <template expr="^record/.*(save-date|modified|save-date)$" field="date_modified" convert="date" flags="keepSmallest"/>
         <template expr="^record/.*(creation-date|created)$" field="date_created" converters="date" flags="keepSmallest"/>
         <template expr="^record/.*title$" field="title" converters="htmlDecode"/>
         <template expr="^record/.*(author|creator)$" field="author" flags="unique|toarray" converters="htmlDecode"/>
         
         <action key="record/_error" type="errorhandler" endpoint="es.errors_" />

         <template expr="^record/content.type$" field="doctype" converters="doctype"/>
         <template expr="^record/content.type$" field="content_type"/>
         <template expr="(^record/(_|X-Parsed-By|Content-Length|resourceName))" nop='true' />
         <template expr="^record/(.*)" field="__$1" />
      </pipeline>
   </pipelines>

   <datasources>
      <datasource name="tika" type="TikaDS" trim="true" maxparallel="2" tikaurl='http://localhost:8080/convert?compress=true&amp;file=/' tikaprocess='tika' pingurl='http://localhost:8080/ping' pingtimeout='30000' logadds="5000">
         <security emit='true' wellknown="everyone" />
         <dbgstore></dbgstore>
         <provider type="FileNameFeeder" root="e:\ma" filter="message-1-36829\.eml$" virtualroot="ma" />
         <provider type="FileNameFeeder" root="e:\ma" filter="\.eml$" virtualroot="ma" />
         <provider type="FileNameFeeder" root="\\bm\c\mailArchive\Peter" filter="\.eml$" virtualroot="ma" />
         <provider type="FileNameFeeder" root="e:\ma" filter="message-1-50709\.eml$" virtualroot="ma" />
         <provider type="FileNameFeeder" root="e:\ma" filter="message-1-27368\.eml$" virtualroot="ma" />
         <provider type="FileNameFeeder" root="e:\ma" filter="message-1-46653\.eml$" virtualroot="ma" />
         <provider type="FileNameFeeder" root="e:\ma" filter="message-1-50709\.eml$" virtualroot="ma" />
         <provider type="FileNameFeeder" root="e:\ma" filter="message-1-26126\.eml$" virtualroot="ma" />
         <provider type="FileNameFeeder" root="\\bm\c\mailArchive\Peter" filter="message-1-26126\.eml$" virtualroot="ma" />
         <_provider type="FileNameFeeder" root="C:\Users\pweerd\Documents" filter="Alma\\Documents\\updateCatalogueRecordResponse\.docx$" virtualroot="docs" />
         <provider type="FileNameFeeder" root="C:\Users\pweerd\Documents" filter="\.pdf$|\.eml$|\.docx$" virtualroot="docs" />
         <provider type="FileNameFeeder" root="C:\Users\pweerd\Documents" filter="\.eml$" virtualroot="docs" />
      </datasource>
      <datasource name="tikadoc" type="TikaDS"  trim="true" maxparallel="2" tikaurl='http://localhost:8080/convert?compress=true&amp;file=/' tikaprocess='tika' pingurl='http://localhost:8080/ping' pingtimeout='30000' logadds="5000">
         <dbgstore>pdf</dbgstore>
         <provider type="FileNameFeeder" root="C:\Users\pweerd\Documents" filter="n\.pdf$" virtualroot="docs" />
         <provider type="FileNameFeeder" root="C:\Users\pweerd\Documents" filter="\.pdf$|\.eml$|\.docx$" virtualroot="docs" />
      </datasource>
   </datasources>updateCatalogueRecordResponse
   
</root>
