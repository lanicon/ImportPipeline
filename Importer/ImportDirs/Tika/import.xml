<?xml version="1.0" encoding="utf-8" ?>
<root>
   <tempdir dir="temp" clearonstart="true" />
   <endpoints>
      <endpoint name="es" type="ESEndpoint" url="http://localhost:9200/">
         <waitfor status="yellow"></waitfor>
         <indexes>
            <index name="bosgoed" config="index.config.js"  >
              <type name="bosdoc" keyfield="filename" datefield="filedate" />  
              <type name="errors_"  />  
            </index>
         </indexes>
      </endpoint>
   </endpoints>

   <converters>
      <converter name="urlEncode"/>
      <converter name="int32"/>
      <converter name="double" decimalsep="," groupsep="."/>
      <converter name="date"   utc="true" formats="yyyyMMdd"/>
      <converter name="lower" />
      <converter name="upper" />
      <converter name="trim" />
      <converter name="doctype" type="ReplaceConverter" dumpmissed="100">
         <replace value="application/pdf" repl="Pdf" />
         <replace value="application/msword" repl="Word" />
         <replace value="application/rtf" repl="Word" />
         <replace value="application/vnd.openxmlformats-officedocument.wordprocessingml.document" repl="Word" />
         <replace value="application/vnd.ms-excel" repl="Excel" />
         <replace value="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" repl="Excel" />
         <replace value="application/vnd.ms-powerpoint" repl="Powerpoint" />
         <replace value="application/vnd.openxmlformats-officedocument.presentationml.presentation" repl="Powerpoint" />
         <replace value="ConversionError" repl="Error" />
         <replace expr=".*text.*" repl="Text" />
         <replace expr=".*message.*" repl="Mail" />
      </converter>

   </converters>
   <processes>
      <process name='tika' maxrestarts="25" log="tika" errlog="" logfrom="tika" clearlogs="false">
         <exe>%JAVA_HOME%\bin\java</exe>
         <arguments>-jar %IMPORT_TIKA_CMD%</arguments>
         <_shutdown method="POST" url="http://localhost:9200/_shutdown" />
         <_shutdown method="POST" url="http://localhost:9200/_cluster/nodes/_local/_shutdown" />
      </process>
   </processes>

   <pipelines>
      <pipeline name="tika" trace="true" converters="trim" endpoint="es.bosdoc" >
         <action key="record" add="*" />
         <action key="record/_start" field="filename" tovar="key"/>
         <action key="record/_start" field="errorFileName" endpoint="es.errors_" />
         <action key="record/lastmodutc" field="filedate" convert="date" tovar="date"/>
         <action key="record/virtualFilename" field="virtualFilename" />
         <action key="record/page_count|record/xmptpg:npages" field="page_count" convert="int32"/>
         <action key="record/_checkexist" check="key|date"/>
         <action key="record/subject" field="subject" />
         <action key="record/keywords" field="keywords" />
         <action key="record/content" field="content" />
         <action key="record/shortcontent" field="shortcontent" />
         <action key="record/Message-From" field="message_from" />
         <action key="record/Message-To" field="message_to" />
         <action key="record/Message-CC" field="message_cc" />
         
         <template expr="^record/.*(creation-date|created)$" field="date_created" convert="date" flags="keepSmallest"/>
         <template expr="^record/.*(save-date|modified|save-date)$" field="date_modified" convert="date" flags="keepSmallest"/>
         <template expr="^record/.*(creation-date|created)$" field="date_created" convert="date" flags="keepSmallest"/>
         <template expr="^record/.*title$" field="title" flags="unique" />
         <template expr="^record/.*(author|creator)$" field="author" flags="unique" />
         
         <action key="record/_error/msg" field="errorText" endpoint="es.errors_" />
         <action key="record/_error/trace" field="errorStack" endpoint="es.errors_" />
         <action key="record/_error/date" field="errorDate" endpoint="es.errors_" />
         <action key="record/_error" add="*" endpoint="es.errors_" />

         <template expr="^record/content.type$" field="doctype" convert="doctype"/>
         <template expr="^record/content.type$" field="content_type"/>
         <template expr="(^record/(_|X-Parsed-By|Content-Length|resourceName))" nop='true' />
         <template expr="^record/(.*)" field="__$1" />
      </pipeline>
   </pipelines>

   <datasources>
      <datasource name="tika" type="TikaDS" trim="true" history="false" tikaurl='http://localhost:8080/html/filesystem/' tikaprocess='tika' pingurl='http://localhost:8080/ping' pingtimeout='30000'>
         <dbgstore>dbgstore2</dbgstore>
         <provider type="FileNameFeeder" root="e:\ma" filter="message-1-42755\.eml$" virtualroot="ma" />
         <_provider type="FileNameFeeder" root="C:\Users\pweerd\Documents" filter="Alma\\Documents\\updateCatalogueRecordResponse\.docx$" virtualroot="docs" />
         <_provider type="FileNameFeeder" root="C:\Users\pweerd\Documents" filter="\.pdf$|\.eml$|\.docx$" virtualroot="docs" />
         <provider type="FileNameFeeder" root="C:\Users\pweerd\Documents" filter="\.eml$" virtualroot="docs" />
      </datasource>
   </datasources>updateCatalogueRecordResponse
   
</root>
