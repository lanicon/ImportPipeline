<?xml version="1.0" encoding="utf-8" ?>
<root importflags="FullImport">
   <tempdir dir="temp" clearonstart="true" />
   <script file="GorillaExt.cs" />
   <endpoints>
      <endpoint name="es" type="ESEndpoint" url="http://localhost:9200/">
         <index name="gorilla" config="index.config.js" optimize="1" >
            <type name="doc" index="gorilla" keyfield="_id" />  
         </index>
         <index name="gorilla_prev" indexname="gorilla" config="">
            <type name="prevdoc" typename="doc" index="gorilla_prev" keyfield="_id" />  
         </index>
      </endpoint>
      <endpoint name="mail" type="htmldatasource#MailEndpoint" limit="1" _email="pweerd@bitmanager.nl" server="bitmanager.nl:2525" force="heineken$|imtech|grontmij|pharming|kpn|heijmans" sort="name"/>
   </endpoints>

   <converters>
      <converter name="double" decimalsep="," groupsep="."/>
      <converter name="date"   utc="true" formats="yyyyMMdd"/>
      <converter name="lower" />
      <converter name="upper" />
      <converter name="trim" />
   </converters>

   <pipelines>
      <pipeline name="gorilla" converters="trim" script="Gorilla" endpoint="es.doc">
         <action key="record" add="*" script="Clear" />
         <action key="record/name" field="name" script="OnName" />
         <action key="record/exchange" field="exchange" script="OnExchange" />
         <action key="record/key" field="id" tovar="key" />
         <action key="record/_preparehistory" emitexisting="history" emitfield="history" maxlevel="2" destination="datasource" endpoint="es.prevdoc"/>
         <template expr="record/(price.*)" field="$1" converters="double"/>
         <template expr="record/(.*)" field="$1" />
      </pipeline>
      
      <pipeline name="gorillaMail" converters="trim" endpoint="mail.mail">
         <action key="record" add="*" />
         <action key="record/name" field="name" converters="trim" />
         <template expr="record/(price.*)" field="$1" converters="double"/>
         <template expr="record/(.*)" field="$1" />
      </pipeline>
   </pipelines>

   <datasources>
      <datasource name="gorillaMail" active="false" type="HtmlDatasource#BeursGorilla.BeursGorillaDS" trim="true" history="false">
         <provider type="UrlFeeder" baseurl="http://www.beursgorilla.nl/" >
            <url exchange="aex" offset="1">aex-streaming-live.asp</url>
            <url exchange="amx" offset="1">amx-streaming-live.asp</url>
            <url exchange="ascx" offset="1">koers-streaming-live.asp</url>
            <url exchange="lokaal">lokaal-streaming-live.asp?b=a-d</url>
            <url exchange="lokaal">lokaal-streaming-live.asp?b=e-o</url>
            <url exchange="lokaal">lokaal-streaming-live.asp?b=p-z</url>
         </provider>   
      </datasource>
      <datasource name="gorilla" active="true" type="HtmlDatasource#BeursGorilla.BeursGorillaDS" trim="true" >
         <provider type="UrlFeeder" baseurl="http://www.beursgorilla.nl/" >
            <url exchange="aex" offset="1">aex-streaming-live.asp</url>
            <url exchange="amx" offset="1">amx-streaming-live.asp</url>
            <url exchange="ascx" offset="1">koers-streaming-live.asp</url>
            <url exchange="lokaal">lokaal-streaming-live.asp?b=a-d</url>
            <url exchange="lokaal">lokaal-streaming-live.asp?b=e-o</url>
            <url exchange="lokaal">lokaal-streaming-live.asp?b=p-z</url>
         </provider>   
      </datasource>
   </datasources>
            <url exchange="aex">aex.asp</url>
            <url exchange="amx">amx.asp</url>
            <url exchange="ascx">koers.asp</url>
            <url exchange="lokaal">lokaal.asp?b=a-d</url>
            <url exchange="lokaal">lokaal.asp?b=e-o</url>
            <url exchange="lokaal">lokaal.asp?b=p-z</url>
   
</root>
